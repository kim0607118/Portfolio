; Top Design: "class PA_lib:HB1Tone_LoadPull:schematic"
; Netlisted using Hierarchy Policy: "Standard"

Options ResourceUsage=yes UseNutmegFormat=no EnableOptim=no TopDesignName="class PA_lib:HB1Tone_LoadPull:schematic" DcopOutputNodeVoltages=yes DcopOutputPinCurrents=yes DcopOutputAllSweepPoints=no DcopOutputDcopType=0
; Library Name: class PA_lib
; Cell Name: fet_81xp
; View Name: schematic
define fet_81xp ( P1  P2  P3 ) 
parameters  T_area=1  F_num=1 
"FLC081XP":EEFET1  N__1 N__0 N__2 Ugw=0.000001*T_area N=F_num Noise=yes _M=1 
L:L1  P2 N__0 L=0.322 nH Noise=yes  
L:L2  N__1 P1 L=0.298 nH Noise=yes  
L:L3  N__2 P3 L=0.0927 nH Noise=yes  
model FLC081XP EE_FET3 Vto=-1.975367 Gamma=0.020060 Vgo=-1.030078 Vdelt=0.099871 Vch=1.0 Gmmax=0.147941 Vdso=2.0 Vsat=1.696747 Kapa=0.255487 Peff=3.0 Vtso=-10.0 Is=1.51e-12 N=1.5 Ris=2.170776 Tau=1.27e-11 Cdso=3.89e-13 Rdb=1.0e+9 Cbs=1.60e-13 Vtoac=-2.099417 Gammaac=0.022542 Vdeltac=0.012398 Gmmaxac=0.198057 Kapaac=6.47e-8 Peffac=20.36817 Vtsoac=-10.0 Gdbm=0.012170 Kdb=16.81255 Vdsm=1.0 C11o=2.72e-12 C11th=1.08e-12 Vinfl=-1.473580 Deltgs=2.002681 Deltds=1.174060 Lambda=0.049380 C12sat=3.12e-21 Cgdsat=3.12e-21 Kbk=0.030 Vbr=21.10 Nbr=2.0 Idsoc=0.374360 Rd=0.05 Rs=0.02 Rg=0.1 Ugw=0.000075 Ngf=10.0 
R:R1  N__5 0 R=1000 Ohm Noise=yes 
C:C1  N__5 P2 C=1500 pF 
end fet_81xp

HB:HB1 MaxOrder=4 Freq[1]=RFfreq Order[1]=5 StatusLevel=3 FundOversample=1 \
Restart=no UseAllSS_Freqs=yes UseOutFile=no \
HBSS_WSP=0 UseInFile=no SweepVar="real_indexs11" SweepPlan="HB1_stim" OutputPlan="HB1_Output" 

SweepPlan: HB1_stim Start=real(s11_center)-c_limit Stop=real(s11_center)+c_limit Lin=pts_per_line 

OutputPlan:HB1_Output \
      Type="Output" \
      UseNodeNestLevel=yes \
      NodeNestLevel=2 \
      UseEquationNestLevel=yes \
      EquationNestLevel=2 \
      EquationName[1]="Pavs" \
      EquationName[2]="Z0" \
      UseSavedEquationNestLevel=yes \
      SavedEquationNestLevel=2 \
      UseDeviceCurrentNestLevel=no \
      DeviceCurrentNestLevel=0 \
      DeviceCurrentDeviceType="All" \
      DeviceCurrentSymSyntax=yes \
      UseCurrentNestLevel=yes \
      CurrentNestLevel=999 \
      UseDeviceVoltageNestLevel=no \
      DeviceVoltageNestLevel=0 \
      DeviceVoltageDeviceType="All"

Tran:HB1_tran HB_Sol=1 SteadyState=1 StatusLevel=3 \
Freq[1]=RFfreq Order[1]=5 

Component:tahb_HB1 Module="ATAHB" Type="ModelExtractor" \ 
 Tran_Analysis="HB1_tran" HB_Analysis="HB1" 

Short:I_In  N__3 V_In Mode=0 SaveCurrent=yes 
Port:PORT1  N__3 0 Num=1 Z=Z_s P[1]=dbmtow(Pavs) Freq[1]=RFfreq    Noise=yes Pac=dbmtow(0) 
#uselib "ckt" , "P_Probe"
P_Probe:P_Load  N__6 N__5 
ParamSweep:Sweep1 SimInstanceName[1]="HB1" StatusLevel=2 SweepVar="imag_indexs11" SweepPlan="Sweep1_stim" 

SweepPlan: Sweep1_stim Start=imag(s11_center)-(max_rho-max_rho/(lines+1)) Stop=imag(s11_center)+(max_rho-max_rho/(lines+1)) Lin=lines 


;Tuner reflection coefficient=
LoadTuner = LoadArray[iload]
LoadArray = list(0,indexs11, fg(Z_l_2), fg(Z_l_3), fg(Z_l_4), fg(Z_l_5))
iload = int(min(abs(freq)/RFfreq+1.5,length(LoadArray)))
fg(x) =(x-conj(Z0))/(x+Z0)
;Source impedances=
Z_s = SrcArray[isrc]
SrcArray = list(Z0, Z_s_fund, Z_s_2,Z_s_3,Z_s_4,Z_s_5)
isrc = min(iload,length(SrcArray))

Z_l_2 =10*Z0 + j*0
Z_l_3 =10*Z0 + j*0
Z_l_4 =10* Z0 + j*0
Z_l_5 =10* Z0 + j*0
Z_s_fund =1.950+j*3.624
Z_s_2 =10* Z0 + j*0
Z_s_3 =10* Z0 + j*0
Z_s_4 =10* Z0 + j*0
Z_s_5 =10* Z0 + j*0
V_Source:SRC1  Vs_high 0 Type="V_DC" Vdc=Vhigh SaveCurrent=1 
V_Source:SRC2  Vs_low 0 Type="V_DC" Vdc=Vlow SaveCurrent=1 
L:L2  N__8 N__14 L=1 uH Noise=yes  
L:L1  N__10 N__23 L=1 uH Noise=yes  
Short:Is_low  Vs_low N__8 Mode=0 SaveCurrent=yes 
Short:Is_high  Vs_high N__10 Mode=0 SaveCurrent=yes 
C:C1  V_In N__14 C=1.0 uF 
S_Port:S1  N__5 0 S[1,1]=LoadTuner Z[1]=Z0 

real_indexs11=0
imag_indexs11=0
indexs11=real_indexs11+j*imag_indexs11
argument =max_rho^2-(imag(s11_center)-imag_indexs11)^2
c_limit=sqrt(if ((argument) <0) then 0 else argument endif)
s11_rho =0.95
s11_center =0.0 +j*0.0
max_rho = min(1.0 - mag(s11_center), mag(s11_rho))
pts=500
lines=max(int(sqrt(pts)),1)
pts_per_line=int(pts/lines)
Z0=50
model FLC301XP GaAs NFET=1 PFET=0 Idsmod=3 Vto=-4 Beta=0.0999 Lambda=0 Alpha=1.7 B=0.0569 Vbi=1.8 Tau=61.0e-12 Cgs=14.0e-12 Cgd=2.4e-12 Rgd=0.98 Fc=0.5 Rd=0.23 Rg=0.03 Rs=0.06 Cds=1.0e-12 Crf=4e-7 Rc=1400 Is=1e-14 N=1.2 Eg=1.11 Vbr=0 Taumdl=1 
fet_81xp:X1  N__23 N__14 0 T_area=10 F_num=100 
C:C2  N__23 N__6 C=1.0 uF 

Pavs=20 _dBm
RFfreq=3 GHz
Vhigh=3
Vlow=-1.4
fet_81xp:X9  N__23 N__14 0 T_area=10 F_num=100 
fet_81xp:X10  N__23 N__14 0 T_area=10 F_num=100 
fet_81xp:X11  N__23 N__14 0 T_area=1 F_num=100 
